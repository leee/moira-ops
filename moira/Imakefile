# $Header: /afs/.athena.mit.edu/astaff/project/moiradev/repository/moira/Imakefile,v 1.8 1997-01-29 22:55:32 danw Exp $
#
# Copyright 1990 by the Massachusetts Institute of Technology.
#
# For copying and distribution information,
# please see the file <mit-copyright.h>.
#
# Imakefile for top level directory.
#

#define have_subdirs
CODE=Imakefile
CLIENTDIRS=util include gdb lib clients man update
SVRDIRS=server db backup dbck dcm gen reg_svr incremental regtape
#ifdef SVRBUILD
SUBDIRS=$(CLIENTDIRS) $(SVRDIRS)
#else
SUBDIRS=$(CLIENTDIRS)
#endif

#ifndef USELOCALTOOLS
all:: et ss
#else
all:: 
#endif

#ifndef USELOCALTOOLS

world::
	make ${MFLAGS} imake
	make ${MFLAGS} Makefile
	make ${MFLAGS} Makefiles
	make ${MFLAGS} depend
	make ${MFLAGS} all

#else /* USELOCALTOOLS */

world::
	make ${MFLAGS} Makefile
	make ${MFLAGS} Makefiles
	make ${MFLAGS} depend
	make ${MFLAGS} all
#endif /* USELOCALTOOLS */

imake::
	cd util/imake; make 

install::
	-mkdir ${DESTDIR}
	-mkdir ${DESTDIR}${USRDIR}
	-mkdir ${DESTDIR}${ETCDIR}
	-mkdir ${DESTDIR}${PROGDIR}
	-mkdir ${DESTDIR}${LIBDIR}
	-mkdir ${DESTDIR}${LINTLIBDIR}
	-mkdir ${DESTDIR}${INCLDIR}
	-mkdir ${DESTDIR}${MANDIR}
	-mkdir ${DESTDIR}${MANDIR}/man1
	-mkdir ${DESTDIR}${MANDIR}/man3
	-mkdir ${DESTDIR}${MANDIR}/man5
	-mkdir ${DESTDIR}${MANDIR}/man8
	-mkdir ./bin

#ifndef USELOCALTOOLS
depend:: makedepend
#endif

#ifndef USELOCALLIBS
depend:: et ss
#endif

et:
	cd util/et; make ${MFLAGS} DEPEND="$(BUILDTOP)/../../$(DEPEND)" depend; make ${MFLAGS} all

ss:
	cd util/ss; make ${MFLAGS} DEPEND="$(BUILDTOP)/../../$(DEPEND)" depend; make ${MFLAGS} all

makedepend:
	cd util/makedepend; make
