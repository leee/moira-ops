# $Header: /afs/.athena.mit.edu/astaff/project/moiradev/repository/moira/util/makeconfig,v 1.9 1997-07-11 00:46:43 danw Exp $
#
#  Copyright 1990 by the Massachusetts Institute of Technology.
# 
#  For copying and distribution information,
#  please see the file <mit-copyright.h>.
#
# Makefile for creating a Moira configuration
#
# This Makefile creates the directories needed to hold Moira
# object files and executables.  It also installs the Imakefiles.
# This also copies in the Imake and make depend program and Imake macros.
# By default, the Imakefiles are copied into the configuration
# and made writeable.  If a link is preferred, change LN to "ln".
#
# The default distination for the configuration is the current
# directory; defaults for destination and source directories may be
# specified, e.g.:
#
# make -f makeconfig SRCDIR=/u2/lockers/moira DESTDIR=myconfig

DESTDIR	= .
SRCDIR 	= /mit/moiradev/src

SYNCTREE = /usr/athena/etc/synctree

all:
	$(SYNCTREE) -q -s $(SRCDIR) -d $(DESTDIR)

	rm -f $(DESTDIR)/Makefile
	cp $(SRCDIR)/Makefile $(DESTDIR)/
	chmod o+w $(DESTDIR)/Makefile

	rm -f $(DESTDIR)/util/imake.includes/config.Imakefile
	sed -e "s|/mit/moiradev/src|${SRCDIR}|" \
		${SRCDIR}/util/imake.includes/config.Imakefile \
		> ${DESTDIR}/util/imake.includes/config.Imakefile
