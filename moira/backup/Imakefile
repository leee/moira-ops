# $Header: /afs/.athena.mit.edu/astaff/project/moiradev/repository/moira/backup/Imakefile,v 1.3 1993-07-14 14:03:31 mar Exp $
#
# Copyright 1990 by the Massachusetts Institute of Technology.
#
# For copying and distribution information,
# please see the file <mit-copyright.h>.
#
# Imakefile for backup directory.
#

SRCS= dump_db.c bkup1.c bkup.c dumprest.c rest_db.c rest1.c rest.c
SRCDIR=${SRCTOP}/backup
CODE= db2bkup.awk db2rest.awk dump_db.h dump_db.dc dumprest.dc \
	nightly.sh report.sh rest_db.dc
BOBJS= dump_db.o bkup1.o bkupfix.o dumprest.o 
ROBJS= rest_db.o rest1.o rest.o dumprest.o
sqlrule()

program(mrbackup, ${BOBJS},${MR_LIBDEP}, ${CLIBS} ${SQL_LIB}, ${PROGDIR})
program(mrrestore, ${ROBJS},${MR_LIBDEP}, ${CLIBS} ${SQL_LIB}, ${PROGDIR})

bkup.dc: ../db/schema db2bkup.awk
	cc -E ../db/schema | awk -f db2bkup.awk > bkup.dc
bkup1.dc: bkup.dc
rest.dc: ../db/schema db2rest.awk
	cc -E ../db/schema | awk -f db2rest.awk > rest.dc
rest1.dc: rest.dc
clean::
	$(RM) bkup.dc bkup1.dc rest.dc rest1.dc
sqlfile(dump_db)
sqlfile(rest_db)
sqlfile(dumprest)
sqlfile(bkup)
sqlfile(bkup1)
sqlfile(rest)
sqlfile(rest1)

bkupfix.c: bkup.c
	esqlc_fix.pl < bkup.c > bkupfix.c
